#!/usr/bin/env node

/*
 *
 * Options:
 *
 *     -c, --config, path to a valid json config file
 *
 * Examples:
 *
 *     watch log from given directory and send the result to backend:
 *     meeplog -m tailer -w /tmp/* -b filesystem -p /tmp/test.json
 *
 *     run as nsq reader and send the logs to stdout:
 *     meeplog -m nsq -nsq-host 127.0.0.1:4500 -b stdout
 *
 *     run as nsq reader and send the logs to elasticsearch:
 *     meeplog -m nsq -nsq-host 127.0.0.1:4500 -b elasticsearch -es-host 127.0.0.1:9200
 *
 */


// the option are first loaded from the config file, command lime option take precedence

var program = require('commander');
var fs = require('fs');


program
    .version('0.5.0')
    .option('-c, --config <path>', 'path to a valid json config file')
    .option('-d, --distributed-config <ip:port>', 'combo of ip:port to distributed config service')
    .option('-m, --mode', 'specify in which mode meeplog will be running.')
    .option('-b, --backend ', 'specify where the log are sent for storage.')
    .parse(process.argv);



function loadConfig(filename, cb) {
    fs.readFile(filename, {
        encoding: 'utf-8'
    }, function(err, data) {
        if (err) {
            cb(err, null)
        } else {
            try {
                var data = JSON.parse(data);
                cb(null, data);
            } catch (e) {
                cb(e, null);
            }

        }
    });
}


function applyConfig(config) {

}